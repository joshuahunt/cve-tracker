
-----------------------------
Stable Kernel Security Notice
2018-03-13

Stable Branch: linux-4.9.y

All linux-4.9.y CVEs:
http://joshuahunt.github.io/cve-tracker/linux-4.9.y-stable-cve-list.html

CVE(s) in report:

CVE-2017-18222
CVE-2017-18224
CVE-2018-7757
CVE-2018-8043
-----------------------------

Details:

*************
CVE-2017-18222:
*************

*** This is a new CVE ***
---
Description of fix for this vulnerability:
commit 412b65d15a7f8a93794653968308fc100f2aa87c
Author: Timmy Li <lixiaoping3@huawei.com>
Date:   Tue May 2 10:46:52 2017 +0800

    net: hns: fix ethtool_get_strings overflow in hns driver
    
    hns_get_sset_count() returns HNS_NET_STATS_CNT and the data space allocated
    is not enough for ethtool_get_strings(), which will cause random memory
    corruption.
    
    When SLAB and DEBUG_SLAB are both enabled, memory corruptions like the
    the following can be observed without this patch:
    [   43.115200] Slab corruption (Not tainted): Acpi-ParseExt start=ffff801fb0b69030, len=80
    [   43.115206] Redzone: 0x9f911029d006462/0x5f78745f31657070.
    [   43.115208] Last user: [<5f7272655f746b70>](0x5f7272655f746b70)
    [   43.115214] 010: 70 70 65 31 5f 74 78 5f 70 6b 74 00 6b 6b 6b 6b  ppe1_tx_pkt.kkkk
    [   43.115217] 030: 70 70 65 31 5f 74 78 5f 70 6b 74 5f 6f 6b 00 6b  ppe1_tx_pkt_ok.k
    [   43.115218] Next obj: start=ffff801fb0b69098, len=80
    [   43.115220] Redzone: 0x706d655f6f666966/0x9f911029d74e35b.
    [   43.115229] Last user: [<ffff0000084b11b0>](acpi_os_release_object+0x28/0x38)
    [   43.115231] 000: 74 79 00 6b 6b 6b 6b 6b 70 70 65 31 5f 74 78 5f  ty.kkkkkppe1_tx_
    [   43.115232] 010: 70 6b 74 5f 65 72 72 5f 63 73 75 6d 5f 66 61 69  pkt_err_csum_fai
    
    Signed-off-by: Timmy Li <lixiaoping3@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/ethernet/hisilicon/hns/hns_dsaf_gmac.c  | 2 +-
 drivers/net/ethernet/hisilicon/hns/hns_dsaf_ppe.c   | 2 +-
 drivers/net/ethernet/hisilicon/hns/hns_dsaf_rcb.c   | 2 +-
 drivers/net/ethernet/hisilicon/hns/hns_dsaf_xgmac.c | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)
---
The following fields have changed: Public Date,CVE,Break Date,Break Commit,Break Tag,Linus Fix Date,Linus Commit,Linus Tag,Stable Date,Stable Commit,Stable Tag
Public Date: 2018-03-08
CVE: CVE-2017-18222
Break Date: -
Break Commit: -
Break Tag: -
Linus Fix Date: 2017-05-02
Linus Commit: 412b65d15a7f8a93794653968308fc100f2aa87c
Linus Tag: 4.12-rc1
Stable Date: -
Stable Commit: -
Stable Tag: -

CVE-2017-18224:
*************

*** This is a new CVE ***
---
Description of fix for this vulnerability:
commit 3e4c56d41eef5595035872a2ec5a483f42e8917f
Author: alex chen <alex.chen@huawei.com>
Date:   Wed Nov 15 17:31:44 2017 -0800

    ocfs2: ip_alloc_sem should be taken in ocfs2_get_block()
    
    ip_alloc_sem should be taken in ocfs2_get_block() when reading file in
    DIRECT mode to prevent concurrent access to extent tree with
    ocfs2_dio_end_io_write(), which may cause BUGON in the following
    situation:
    
    read file 'A'                                  end_io of writing file 'A'
    vfs_read
     __vfs_read
      ocfs2_file_read_iter
       generic_file_read_iter
        ocfs2_direct_IO
         __blockdev_direct_IO
          do_blockdev_direct_IO
           do_direct_IO
            get_more_blocks
             ocfs2_get_block
              ocfs2_extent_map_get_blocks
               ocfs2_get_clusters
                ocfs2_get_clusters_nocache()
                 ocfs2_search_extent_list
                  return the index of record which
                  contains the v_cluster, that is
                  v_cluster > rec[i]->e_cpos.
                                                    ocfs2_dio_end_io
                                                     ocfs2_dio_end_io_write
                                                      down_write(&oi->ip_alloc_sem);
                                                      ocfs2_mark_extent_written
                                                       ocfs2_change_extent_flag
                                                        ocfs2_split_extent
                                                         ...
                                                     --> modify the rec[i]->e_cpos, resulting
                                                         in v_cluster < rec[i]->e_cpos.
                 BUG_ON(v_cluster < le32_to_cpu(rec->e_cpos))
    
    [alex.chen@huawei.com: v3]
      Link: http://lkml.kernel.org/r/59EF3614.6050008@huawei.com
    Link: http://lkml.kernel.org/r/59EF3614.6050008@huawei.com
    Fixes: c15471f79506 ("ocfs2: fix sparse file & data ordering issue in direct io")
    Signed-off-by: Alex Chen <alex.chen@huawei.com>
    Reviewed-by: Jun Piao <piaojun@huawei.com>
    Reviewed-by: Joseph Qi <jiangqi903@gmail.com>
    Reviewed-by: Gang He <ghe@suse.com>
    Acked-by: Changwei Ge <ge.changwei@h3c.com>
    Cc: Mark Fasheh <mfasheh@versity.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Junxiao Bi <junxiao.bi@oracle.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/ocfs2/aops.c | 26 ++++++++++++++++++--------
 1 file changed, 18 insertions(+), 8 deletions(-)
---
The following fields have changed: Public Date,CVE,Break Date,Break Commit,Break Tag,Linus Fix Date,Linus Commit,Linus Tag,Stable Date,Stable Commit,Stable Tag
Public Date: 2018-03-11
CVE: CVE-2017-18224
Break Date: 2016-03-25
Break Commit: c15471f79506830f80eca0e7fe09b8213953ab5f
Break Tag: 4.6-rc1
Linus Fix Date: 2017-11-15
Linus Commit: 3e4c56d41eef5595035872a2ec5a483f42e8917f
Linus Tag: 4.15-rc1
Stable Date: -
Stable Commit: -
Stable Tag: -

CVE-2018-7757:
*************

*** This is a new CVE ***
---
Description of fix for this vulnerability:
commit 4a491b1ab11ca0556d2fda1ff1301e862a2d44c4
Author: Jason Yan <yanaijie@huawei.com>
Date:   Thu Jan 4 21:04:31 2018 +0800

    scsi: libsas: fix memory leak in sas_smp_get_phy_events()
    
    We've got a memory leak with the following producer:
    
    while true;
    do cat /sys/class/sas_phy/phy-1:0:12/invalid_dword_count >/dev/null;
    done
    
    The buffer req is allocated and not freed after we return. Fix it.
    
    Fixes: 2908d778ab3e ("[SCSI] aic94xx: new driver")
    Signed-off-by: Jason Yan <yanaijie@huawei.com>
    CC: John Garry <john.garry@huawei.com>
    CC: chenqilin <chenqilin2@huawei.com>
    CC: chenxiang <chenxiang66@hisilicon.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Hannes Reinecke <hare@suse.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

 drivers/scsi/libsas/sas_expander.c | 1 +
 1 file changed, 1 insertion(+)
---
The following fields have changed: Public Date,CVE,Break Date,Break Commit,Break Tag,Linus Fix Date,Linus Commit,Linus Tag,Stable Date,Stable Commit,Stable Tag
Public Date: 2018-03-08
CVE: CVE-2018-7757
Break Date: 2006-08-29
Break Commit: 2908d778ab3e244900c310974e1fc1c69066e450
Break Tag: 2.6
Linus Fix Date: 2018-01-08
Linus Commit: 4a491b1ab11ca0556d2fda1ff1301e862a2d44c4
Linus Tag: 4.16-rc3
Stable Date: -
Stable Commit: -
Stable Tag: -

CVE-2018-8043:
*************

*** This is a new CVE ***
---
Description of fix for this vulnerability:
commit 297a6961ffb8ff4dc66c9fbf53b924bd1dda05d5
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Thu Jan 11 11:21:51 2018 +0000

    net: phy: mdio-bcm-unimac: fix potential NULL dereference in unimac_mdio_probe()
    
    platform_get_resource() may fail and return NULL, so we should
    better check it's return value to avoid a NULL pointer dereference
    a bit later in the code.
    
    This is detected by Coccinelle semantic patch.
    
    @@
    expression pdev, res, n, t, e, e1, e2;
    @@
    
    res = platform_get_resource(pdev, t, n);
    + if (!res)
    +   return -EINVAL;
    ... when != res == NULL
    e = devm_ioremap(e1, res->start, e2);
    
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

 drivers/net/phy/mdio-bcm-unimac.c | 2 ++
 1 file changed, 2 insertions(+)
---
The following fields have changed: Public Date,CVE,Break Date,Break Commit,Break Tag,Linus Fix Date,Linus Commit,Linus Tag,Stable Date,Stable Commit,Stable Tag
Public Date: 2018-03-10
CVE: CVE-2018-8043
Break Date: -
Break Commit: -
Break Tag: -
Linus Fix Date: 2018-01-11
Linus Commit: 297a6961ffb8ff4dc66c9fbf53b924bd1dda05d5
Linus Tag: 4.16-rc1
Stable Date: -
Stable Commit: -
Stable Tag: -
