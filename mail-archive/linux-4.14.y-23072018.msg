
-----------------------------
Stable Kernel Security Notice
2018-07-23

Stable Branch: linux-4.14.y

All linux-4.14.y CVEs:
http://joshuahunt.github.io/cve-tracker/linux-4.14.y-stable-cve-list.html

CVE(s) in report:

CVE-2017-18216
CVE-2017-18224
-----------------------------

Details:

*************
CVE-2017-18216:
*************

This CVE has been resolved in 4.14.57.
Please pull this or a newer version of the kernel to resolve this security vulnerability.

---
Description of fix for this vulnerability:
commit 853bc26a7ea39e354b9f8889ae7ad1492ffa28d2
Author: alex chen <alex.chen@huawei.com>
Date:   Wed Nov 15 17:31:48 2017 -0800

    ocfs2: subsystem.su_mutex is required while accessing the item->ci_parent
    
    The subsystem.su_mutex is required while accessing the item->ci_parent,
    otherwise, NULL pointer dereference to the item->ci_parent will be
    triggered in the following situation:
    
    add node                     delete node
    sys_write
     vfs_write
      configfs_write_file
       o2nm_node_store
        o2nm_node_local_write
                                 do_rmdir
                                  vfs_rmdir
                                   configfs_rmdir
                                    mutex_lock(&subsys->su_mutex);
                                    unlink_obj
                                     item->ci_group = NULL;
                                     item->ci_parent = NULL;
    	 to_o2nm_cluster_from_node
    	  node->nd_item.ci_parent->ci_parent
    	  BUG since of NULL pointer dereference to nd_item.ci_parent
    
    Moreover, the o2nm_cluster also should be protected by the
    subsystem.su_mutex.
    
    [alex.chen@huawei.com: v2]
      Link: http://lkml.kernel.org/r/59EEAA69.9080703@huawei.com
    Link: http://lkml.kernel.org/r/59E9B36A.10700@huawei.com
    Signed-off-by: Alex Chen <alex.chen@huawei.com>
    Reviewed-by: Jun Piao <piaojun@huawei.com>
    Reviewed-by: Joseph Qi <jiangqi903@gmail.com>
    Cc: Mark Fasheh <mfasheh@versity.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Junxiao Bi <junxiao.bi@oracle.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/ocfs2/cluster/nodemanager.c | 63 ++++++++++++++++++++++++++++++++++++------
 1 file changed, 55 insertions(+), 8 deletions(-)
---
The following fields have changed: Stable Date,Stable Commit,Stable Tag
Stable Date: - -> 2018-07-22
Stable Commit: - -> c59a8f13f36b51f2100111121b39c6d15eca124d
Stable Tag: - -> 4.14.57

CVE-2017-18224:
*************

This CVE has been resolved in 4.14.57.
Please pull this or a newer version of the kernel to resolve this security vulnerability.

---
Description of fix for this vulnerability:
commit 3e4c56d41eef5595035872a2ec5a483f42e8917f
Author: alex chen <alex.chen@huawei.com>
Date:   Wed Nov 15 17:31:44 2017 -0800

    ocfs2: ip_alloc_sem should be taken in ocfs2_get_block()
    
    ip_alloc_sem should be taken in ocfs2_get_block() when reading file in
    DIRECT mode to prevent concurrent access to extent tree with
    ocfs2_dio_end_io_write(), which may cause BUGON in the following
    situation:
    
    read file 'A'                                  end_io of writing file 'A'
    vfs_read
     __vfs_read
      ocfs2_file_read_iter
       generic_file_read_iter
        ocfs2_direct_IO
         __blockdev_direct_IO
          do_blockdev_direct_IO
           do_direct_IO
            get_more_blocks
             ocfs2_get_block
              ocfs2_extent_map_get_blocks
               ocfs2_get_clusters
                ocfs2_get_clusters_nocache()
                 ocfs2_search_extent_list
                  return the index of record which
                  contains the v_cluster, that is
                  v_cluster > rec[i]->e_cpos.
                                                    ocfs2_dio_end_io
                                                     ocfs2_dio_end_io_write
                                                      down_write(&oi->ip_alloc_sem);
                                                      ocfs2_mark_extent_written
                                                       ocfs2_change_extent_flag
                                                        ocfs2_split_extent
                                                         ...
                                                     --> modify the rec[i]->e_cpos, resulting
                                                         in v_cluster < rec[i]->e_cpos.
                 BUG_ON(v_cluster < le32_to_cpu(rec->e_cpos))
    
    [alex.chen@huawei.com: v3]
      Link: http://lkml.kernel.org/r/59EF3614.6050008@huawei.com
    Link: http://lkml.kernel.org/r/59EF3614.6050008@huawei.com
    Fixes: c15471f79506 ("ocfs2: fix sparse file & data ordering issue in direct io")
    Signed-off-by: Alex Chen <alex.chen@huawei.com>
    Reviewed-by: Jun Piao <piaojun@huawei.com>
    Reviewed-by: Joseph Qi <jiangqi903@gmail.com>
    Reviewed-by: Gang He <ghe@suse.com>
    Acked-by: Changwei Ge <ge.changwei@h3c.com>
    Cc: Mark Fasheh <mfasheh@versity.com>
    Cc: Joel Becker <jlbec@evilplan.org>
    Cc: Junxiao Bi <junxiao.bi@oracle.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

 fs/ocfs2/aops.c | 26 ++++++++++++++++++--------
 1 file changed, 18 insertions(+), 8 deletions(-)
---
The following fields have changed: Stable Date,Stable Commit,Stable Tag
Stable Date: - -> 2018-07-22
Stable Commit: - -> 1ccab2bf726e1cd9292deecf4d72d732527035d6
Stable Tag: - -> 4.14.57
